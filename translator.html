<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>translator</title>

    <style>
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100dvw;
        height: 100dvh;
      }
      #translator {
        width: 400px;
        height: 200px;
        /* top: 95%; */
        /* right: -360px; */
        background: #f6f6f6;
        border: 1px solid;
        border-radius: 4px;
        position: fixed;
        transition: right 0.5s ease;
        padding: 5px;
        display: flex;
        flex-direction: column;
        z-index: 2010;
        box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px,
          rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
      }
      #translator.open {
        top: 70%;
        right: 5%;
      }

      #close_tran {
        position: absolute;
        right: -10px;
        top: -10px;
        border-radius: 100%;
        background: red;
        width: 35px;
        height: 35px;
        /* display: flex; */
        align-items: center;
        justify-content: center;
        flex-direction: column;
        cursor: pointer;
        color: white;
        display: none;
      }
      #open_tran {
        position: absolute;
        left: -10px;
        top: -10px;
        border-radius: 100%;
        background: #b9b9b9;
        width: 35px;
        height: 35px;
        /* display: flex; */
        align-items: center;
        justify-content: center;
        flex-direction: column;
        cursor: pointer;
        display: none;
      }
    </style>
  </head>
  <body>
    <div style="width: 50%">
      <h4>เนื้อเพลง รักนานๆ</h4>
      <p>
        ฉันรู้ว่าฉันโชคดีเท่าไหร่&nbsp; ที่ได้มีเธอร่วมเดินข้างกัน&nbsp;
        จับมือและคอยรับฟังในวันที่ผิดหวัง&nbsp; ไม่ไปไหน ในทุก ๆ
        วันฉันกลัวเหลือเกิน&nbsp; กลัวมีซักวันที่เธอหายไป&nbsp; ตลอดไปมีจริงไหม
        ฉันภาวนาให้เป็นเรื่องจริง&nbsp; ช่วยอยู่ให้ฉันรักนาน ๆ ได้ไหม&nbsp;
        ช่วยอยู่กันอย่างนี้นาน ๆ ได้ไหม&nbsp; แค่อยากจะเก็บทุก ๆ เวลา
        และทุกวินาที&nbsp; ที่ฉันมีเธอคนนี้ข้าง ๆ กัน ช่วยอยู่ให้ฉันรักนาน ๆ
        ได้ไหม&nbsp; ช่วยอยู่กันอย่างนี้นาน ๆ&nbsp; เพราะเธอนั้นคือ
        ความสุขของฉัน&nbsp; สัญญาจะดูแลจนวันสุดท้าย และจะรักเธอ
        จนรักใครไม่ได้อีก ชีวิตที่เหลือไม่รู้เป็นไง แค่เรามีกันก็ไม่เป็นไร
        ตลอดไปมีจริงไหม ฉันภาวนาให้เป็นเรื่องจริง&nbsp; ช่วยอยู่ให้ฉันรักนาน ๆ
        ได้ไหม&nbsp; ช่วยอยู่กันอย่างนี้นาน ๆ ได้ไหม&nbsp; แค่อยากจะเก็บทุกๆเวลา
        และทุกวินาที&nbsp; ที่ฉันมีเธอคนนี้ข้าง ๆ กัน ช่วยอยู่ให้ฉันรักนาน ๆ
        ได้ไหม&nbsp; ช่วยอยู่กันอย่างนี้นาน ๆ&nbsp; เพราะเธอนั้นคือ
        ความสุขของฉัน&nbsp; สัญญาจะดูแลจนวันสุดท้าย และจะรักเธอ
        จนรักใครไม่ได้อีก อธิษฐานวิงวอนกับดาวนับร้อยพัน
        ให้เธอนั้นเป็นรักสุดท้ายจะได้ไหม ช่วยอยู่ให้ฉันรักนาน ๆ ได้ไหม&nbsp;
        ช่วยอยู่กันอย่างนี้นาน ๆ ได้ไหม&nbsp; แค่อยากจะเก็บทุก ๆ เวลา
        และทุกวินาที&nbsp; ที่ฉันมีเธอคนนี้ข้าง ๆ กัน ช่วยอยู่ให้ฉันรักนาน ๆ
        ได้ไหม&nbsp; ช่วยอยู่กันอย่างนี้นาน ๆ&nbsp; เพราะเธอนั้นคือ
        ความสุขของฉัน&nbsp; สัญญาจะดูแลจนวันสุดท้าย และจะรักเธอ
        จนรักใครไม่ได้อีก
      </p>
    </div>

    <div id="translator" class="smooth">
      <div id="open_tran" onclick="togglePosition('open')">
        <p style="margin: 0">แปล</p>
      </div>
      <div class="mb-3">
        <label for="exampleFormControlTextarea1" class="form-label"
          >แปลภาษา</label
        >
        <textarea
          id="word_id"
          class="form-control"
          id="exampleFormControlTextarea1"
          rows="3"
          placeholder="ลากข้อความบนเว็บ จะแปลอัตโนมัติ และกดctrl+v ได้เลย"
        ></textarea>
      </div>
      <div id="close_tran" onclick="togglePosition('close')">
        <p style="margin: 0">x</p>
      </div>
      <div>
        <button type="button" class="btn btn-dark" onclick="translatex()">
          Translate <b><span id="loadingTran"></span></b>
        </button>

        <label
          >Auto Translate
          <input type="checkbox" id="checkBoxAutoTran" />
        </label>
        <button
          type="button"
          id="btn_copyText"
          style="display: none"
          class="btn btn-dark"
          onclick="copyText()"
        >
          copy
        </button>
        <div id="test_text" style="display: none"></div>
      </div>
    </div>
  </body>
</html>

<!-- cdn -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
  rel="stylesheet"
/>

<script>
  let loadingTran = document.getElementById("loadingTran");
  let checkBoxAutoTran = document.getElementById("checkBoxAutoTran");

  function translatex(
    sentences = document.getElementById("word_id").value,
    targetDiv = document.getElementById("test_text")
  ) {
    let word = sentences.replace(/\n/g, "<br>");
    if (word == "") return;

    const regex = /[a-zA-Z]+/g;

    const matches = word.match(regex);
    let from_lang;
    let to_lang;
    if (matches) {
      from_lang = "en";
      to_lang = "th";
    } else {
      from_lang = "th";
      to_lang = "en";
    }

    let endPoint = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${from_lang}&tl=${to_lang}&dt=t&ie=UTF-8&oe=UTF-8&q=${encodeURIComponent(
      word
    )}`;

    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var jsonText = JSON.parse(this.responseText);
        text = jsonText[0][0][0];
        text = text.replace(/<br>/g, "\n");
        targetDiv.innerHTML = "&nbsp;" + text;
        loadingTran.style.display = "inline-block";
        setTimeout(() => {
          document.getElementById("btn_copyText").click();
        }, 500);
      }
    };
    xhttp.open("GET", endPoint, true);
    xhttp.send();
  }

  function copyText() {
    let textToCopy = document.getElementById("test_text").innerText;
    textToCopy = textToCopy.trim();
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard
        .writeText(textToCopy)
        .then(() => {
          loadingTran.style.display = "none";
        })
        .catch((err) => {
          console.error("Failed to copy text: ", err);
        });
    } else {
      const textArea = document.createElement("textarea");
      textArea.value = textToCopy;
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand("copy");
        loadingTran.style.display = "none";
      } catch (err) {
        console.error("Failed to copy text: ", err);
      }
      document.body.removeChild(textArea);
    }
    document.getElementById("word_id").value = textToCopy;
  }

  function togglePosition(action) {
    // const translator = document.getElementById("translator");
    // const open_tran = document.getElementById("open_tran");
    // const close_tran = document.getElementById("close_tran");
    // if (action === "open") {
    //   open_tran.style.display = "none";
    //   close_tran.style.display = "flex";
    //   translator.classList.add("open");
    //   sessionStorage.setItem("translatorState", "open");
    // } else if (action === "close") {
    //   open_tran.style.display = "flex";
    //   close_tran.style.display = "none";
    //   translator.classList.remove("open");
    //   sessionStorage.setItem("translatorState", "close");
    // }
  }
  document.addEventListener("DOMContentLoaded", function () {
    const savedState = sessionStorage.getItem("translatorState");
    if (savedState) {
      togglePosition(savedState);
    }
  });

  document
    .getElementById("word_id")
    .addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        translatex();
      }
    });

  document.addEventListener("mouseup", function () {
    if (checkBoxAutoTran.checked == true) {
      let selectedText = window.getSelection().toString().trim();
      word_id.value = selectedText;
      setTimeout(() => {
        translatex();
      }, 200);
    }
  });

  function loadCheckboxState() {
    const checkBox = document.getElementById("checkBoxAutoTran");
    const savedState = sessionStorage.getItem("checkBoxAutoTran");
    if (savedState !== null) {
      checkBox.checked = JSON.parse(savedState);
    }
  }
  function saveCheckboxState() {
    const checkBox = document.getElementById("checkBoxAutoTran");
    sessionStorage.setItem(
      "checkBoxAutoTran",
      JSON.stringify(checkBox.checked)
    );
  }
  document.addEventListener("DOMContentLoaded", loadCheckboxState);
  document
    .getElementById("checkBoxAutoTran")
    .addEventListener("change", saveCheckboxState);

  // press esc
  document.addEventListener("keydown", function (event) {
    if (event.key === "Escape" || event.keyCode === 27) {
      togglePosition("close");
    }
  });
</script>

<script>
  let menuCircles = document.querySelectorAll(".menu-circle");
  let btnMenu = document.getElementById("btn_menu");
  let intervalId;
  let move = false;

  function startMoving() {
    menuCircles.forEach((element) => {
      element.classList.add("move");
      element.classList.remove("back");
    });
    btnMenu.classList.remove("not-moved");
    btnMenu.classList.add("moved");
    move = true;

    clearInterval(intervalId);
  }

  function stopMoving() {
    intervalId = setInterval(() => {
      menuCircles.forEach((element) => {
        element.classList.remove("move");
        element.classList.add("back");
      });
      btnMenu.classList.remove("moved");
      btnMenu.classList.add("not-moved");
      move = false;
    }, 500);
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let translator = document.getElementById("translator");

    let isDraggingMove = false;
    let startXMove = 0;
    let startYMove = 0;
    let startLeftMove = 0;
    let startTopMove = 0;

    // let isDraggingScale = false;
    // let startXScale = 0;
    // let startYScale = 0;
    // let startWidth1 = 0;
    // let startHeight1 = 0;
    // let startWidth2 = 0;
    // let startHeight2 = 0;

    translator.addEventListener("mousedown", onMouseDownMove);
    translator.addEventListener("touchstart", onMouseDownMove);

    translator.addEventListener("dblclick", function () {
      //   moveDiv1.classList = "smooth";
      translator.classList = "smooth";

      setTimeout(() => {
        // moveDiv1.style.left = "unset";
        // moveDiv1.style.top = "10%";
        // moveDiv1.style.right = "10%";

        translator.style.left = "unset";
        translator.style.top = "calc(10% - 0px)";
        translator.style.right = "calc(10% - 0px)";
      }, 200);

      setTimeout(() => {
        // moveDiv1.classList.remove("smooth");
        translator.classList.remove("smooth");
      }, 300);
    });

    // scale.addEventListener("mousedown", onMouseDownScale);
    // scale.addEventListener("touchstart", onMouseDownScale);

    function onMouseDownMove(e) {
      isDraggingMove = true;
      startXMove = e.clientX || e.touches[0].clientX;
      startYMove = e.clientY || e.touches[0].clientY;
      startLeftMove = parseInt(getComputedStyle(translator).left, 10) || 0;
      startTopMove = parseInt(getComputedStyle(translator).top, 10) || 0;
      e.preventDefault();
    }

    function onMouseMove(e) {
      if (isDraggingMove) {
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        const deltaX = clientX - startXMove;
        const deltaY = clientY - startYMove;
        // moveDiv1.style.left = startLeftMove + deltaX + 0 + "px";
        // moveDiv1.style.top = startTopMove + deltaY + 0 + "px";
        translator.style.left = startLeftMove + deltaX + "px";
        translator.style.top = startTopMove + deltaY + "px";
        e.preventDefault();
      }
    }

    function onMouseUpMove() {
      isDraggingMove = false;
    }

    function onMouseDownScale(e) {
      isDraggingScale = true;
      startXScale = e.clientX || e.touches[0].clientX;
      startYScale = e.clientY || e.touches[0].clientY;
      startWidth1 = parseInt(getComputedStyle(translator).width, 10) || 0;
      startHeight1 = parseInt(getComputedStyle(translator).height, 10) || 0;

      document.addEventListener("mousemove", onMouseMoveScale);
      document.addEventListener("touchmove", onMouseMoveScale);
      document.addEventListener("mouseup", onMouseUpScale);
      document.addEventListener("touchend", onMouseUpScale);
      e.preventDefault();
    }

    function onMouseMoveScale(e) {
      if (isDraggingScale) {
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        const deltaX = clientX - startXScale;
        const deltaY = clientY - startYScale;

        translator.style.width = startWidth1 + deltaX + "px";
        translator.style.height = startHeight1 + deltaY + "px";
        e.preventDefault();
      }
    }

    function onMouseUpScale() {
      isDraggingScale = false;
      document.removeEventListener("mousemove", onMouseMoveScale);
      document.removeEventListener("touchmove", onMouseMoveScale);
      document.removeEventListener("mouseup", onMouseUpScale);
      document.removeEventListener("touchend", onMouseUpScale);
    }

    document.addEventListener("mousemove", onMouseMove);
    document.addEventListener("touchmove", onMouseMove);

    document.addEventListener("mouseup", onMouseUpMove);
    document.addEventListener("touchend", onMouseUpMove);
    document.addEventListener("touchcancel", onMouseUpMove);
  });
</script>
